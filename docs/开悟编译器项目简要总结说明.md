# 开悟编译器项目简要总结说明

[TOC]

## 1 写在前面

### 1.1 立项缘由

这个编译器的名字是`SatoriCompiler`。

`Satori`，意为**开悟、顿悟**。我为自己的编译器赋予此名，是期望自己能在动手实践的过程中不断地收获在**知识技能上的顿悟**，以及在**人生方向上的开悟**。`Satori`其实是一个**系列**，是我**大学实践探索的轨迹**。类似的，我还写了`SatoriOS`（基于龙芯的微型**操作系统**）和`SatoriBlog`（Vue+Spring+MySQL）的个人论坛**博客系统**。

在大学学习的方向上，我推崇**实践导向**和**问题导向**，认为**只有在不断实践中才能发现有价值的问题，只有在解决问题的过程中才能真正地学到知识和技能**。同时，我坚信，**量变才能产生质变**，只有一定的代码量的积累，才能真正培养出**利用计算机解决实际问题**的能力。编译器作为公认的编程届**三大浪漫**（分别是操作系统、编译器和计算机图形学）之一，又作为专业课程中的**核心一环**，必然蕴含了大量值得学习研究的思想和方法。因此，我认为自己动手实现一个小型的编译器非常有意义，这也必将是我求知道路上具有**里程碑意义**的一件大事。

### 1.2 项目定位

我要做的是一个**独立**的、**有效**的编译器，既不简单，也不复杂。

不简单，是指**所有代码均自主编写**，不依赖除STL以外的库和工具。在这个项目中，我常用的**日志输出工具、表格排版工具、元信息解析工具和输入流浏览工具**均是我手动编写的。同时我要求这个编译器必须有足够的**抽象性**和**鲁棒性**。所谓抽象性，即是编译器要能提供尽可能高的抽象，允许用户自定义词法、语法乃至语义，编译器要能根据用户给出的**正则表达式**定义的词法自动生成基于NFA的词法分析器，要能根据**EBNF**定义的文法自动生成语法分析器（也就是老师说的**自动造表**），编译器要将语法分析得到的**CST**转化为简洁清晰的**AST**，以便对语义分析部分隐去不必要的细节，编译器要生成基于**LLVM IR**的中间表示（可以理解为三地址码的升级版），这样便可借助LLVM工具链来验证编译器前端生成结果的正确性，也可以利用LLVM后端实现代码优化，使得编译器真正具有**实用价值**。

不复杂，指的是要**综合投入成本和时间效率**的考虑，将实现重心放在编译器的**前端**，同时完成老师布置的实践作业。由于时间原因，编译器很难做到良好的**错误提示**和**代码优化**，这部分工作可以放到暑假参与编译竞赛的过程中去做。

### 1.3 开发环境

项目使用`C++20`标准（低于此标准可能导致编译错误），基于`MSVC（Microsoft Visual C++）`编译器（如果使用GCC编译可能出现问题）。项目使用`CMake`工具辅助工程构建。项目开发使用`Visual Studio Code`和`Visual Studio 2022`，其中`VSCode`是开发主力，`VS 2022`则主要在测试调试时使用。项目接受文件输入，产生命令行输出。

## 2 项目架构

### 2.1 元信息的定义和解析器实现

### 2.2 基于正则引擎的词法分析器

### 2.3 递归下降的EBNF文法解析器

文法解析器不是语法分析器。

### 2.4 扩展语法分析器与扩展文法

### 2.5 三种解析语法树的构造转换

修枝剪叶，添加层数可以简化问题

### 2.6 类LLVM IR的中间表示生成

LLVM IR（LLVM Intermediate Representation）是 LLVM （Low-Level Virtual Machine）编译器框架中的一种中间代码表示形式，它类似于汇编语言，但比汇编语言更高级，但比常见的编程语言更低级。

LLVM IR 的设计初衷是为了提供一种通用的中间代码表示形式，可以被多种编程语言的前端所使用，并且可以被编译成多种目标平台的机器码。LLVM IR 具有以下特点：

1. 类型安全：LLVM IR 代码中的每个值都有一个明确的类型，并且类型检查是在编译时进行的，可以帮助开发者避免类型错误。
2. 抽象：LLVM IR 代码中的指令和操作符可以看作是高级语言中的语法结构，可以方便地表示程序的逻辑结构和算法。
3. 可移植性：LLVM IR 代码可以被编译成多种目标平台的机器码，具有很好的可移植性和可扩展性。

在 LLVM 编译器框架中，LLVM IR 通常是前端将源代码编译成的中间代码表示形式，经过优化和转换后再生成目标平台的机器码。同时，LLVM IR 代码也可以手动编写，用于实现一些特殊的编译器优化或调试功能。

使用 LLVM IR 作为个人实现编译器的输出结果有以下优势：

1. 简单：LLVM IR 代码比目标平台的汇编语言更容易理解和调试，可以帮助开发者更快速地实现编译器的各个阶段。
2. 可移植：LLVM 编译器可以将 LLVM IR 代码编译成多种目标平台的机器码，可以帮助开发者更方便地测试和验证编译器的正确性和性能。
3. 高效：LLVM 编译器框架具有优秀的优化能力，可以将 LLVM IR 代码优化成更高效的机器码，从而提高程序的性能。

### 2.7 面向NASM的目标代码生成

## 3 运行结果

3.1 

## 4 相关记录

### 4.1 代码统计

核心代码 注释率

说明文档

配置文件

测试样例

### 4.2 提交记录

### 4.3 删改记录

## 5 代码说明

### 5.1 代码开源

### 5.2 文件结构